<template id="select-option-template">
	<style>
		@import "/modules/wwi/component/design/host.css";
		:host {
			--margin:8px;
			--bg:rgba(245, 245, 255, 0.91);

			background-color: var(--bg);
			box-sizing: content-box;
			cursor: pointer;
			display: block;
			font-size: 18px;
			height:44px;
			outline: none;
			position: absolute;
			top: 0;
			transform:translate(0,0);
			transition-property: transform, opacity,background, color;
			transform-origin: center center;
			width: 100%;
			will-change: transform, opacity, background, color;
		}

		:host(:focus){
			background-color: currentColor;
			color: var(--bg);
		}
		:host(:focus) [title]{
			color: var(--bg);
		}

		[view] *{
			position: relative;
			box-sizing: border-box;
			overflow: hidden;
		}

		[icon-container]{
			display: inline-block;
			height:35px;
			width: 35px;
			overflow: visible;
			border-radius: 100px;
			margin-left:var(--margin);
			margin-right:var(--margin);
		}

		[icon-container] > [icon]{
			position: absolute;
			top:0;
			left:0;
			bottom:0;
			right:0;
			height:35px;
			width: 35px;
			display: block;
			background-color:white;
			background-repeat: no-repeat;
			background-size: calc(100% - 10px) auto;
			background-position: center center;
			border-radius: 100px;
		}

		[selected-symbol]{
			position: absolute;
			display: none;
			right:20px;
			top:calc(50% - 12.5px);
			font-size:20px;
		}

		:host([aria-selected="true"]) [selected-symbol]{
			display: block;
		}

		:host([button]):after {
			content: '\25BC';
			position: absolute;
			bottom:0px;
			right: 0px;
			top: 0px;
			width: 50px;
			text-align: center;
			font-size: 12px;
			height: 100%;
			box-sizing: border-box;
			line-height: 44px;
			color: inherit;
		}

		:host([button]:active):after {
			content: '\25B2';
		}

		[title]{
			margin-right:var(--margin);
			display: inline-block;
			width: calc(100% - 40px);
		}

	</style>
	<div view gui horizontal center-center>
		<div icon-container gui vertical center-center style="display:none"></div>
		<div title>Title</div>
		<div selected-symbol>&star;</div>
	</div>

</template>
<script>
	(function (doc) {
		const Option = wwi.element(doc,'a11y')
		Option(class extends Option.Element{
			constructor(){
				super({
					name:true,
					icon:true,
					selected:true
				})
				if(!this.hasAttribute('button')) this.setAttribute('slot','select-option')
			}
			a11y_connected(ally) {
				if(ally){
					if(this.kind === 'button'){
						ally.on('keydown', e => {
							if (e.key.activates) this.dispatch('toggle',this)
							else if(e.key.code !== 9) this.dispatch('focus item',e.key)
						})
						ally.on('click', e => this.dispatch('toggle',this))
					}else{
						ally.on('keydown', e => {
							if (e.key.activates) this.select()
							else if(this.focuses_item && e.key.code === 38) this.dispatch('focus button')
						})
						ally.on('click', e => this.select())
					}
				}
			}
			changed(name,old,value){
				switch(name){
					case 'icon':
						let icon_container = this.query('[icon-container]')
						var icon = icon_container ? icon_container.querySelector('[icon]'):null
						if(value){
							icon_container.style.display = ''
							icon = create_icon_element(value,this.hasAttribute('wwi'))
							icon_container.appendChild(icon)
						}
						else if(icon) {
							icon_container.style.display = 'none'
							icon.remove()
						}
						break
					case 'selected':
						if(value !== null) this.aria.selected = 'true'
						else this.aria.selected = 'false'
						break
					case 'name':
						this.query('[title]').innerHTML = value
						break
				}
			}
			connected(){
				if(!this.hasAttribute('button')) this.kind = 'menuitem'
				else this.kind = 'button'
			}
			select(){
				this.selected = true
				this.dispatch('selected',this.selected)
			}
		})

		function create_icon_element(src,from_wwi){
			let img = document.createElement('div')
			if(from_wwi){
				src = url.component('design/icons',src)
			}
			img.style.backgroundImage = `url(${src})`
			img.setAttribute('icon','')
			img.setAttribute('gui','')
			img.setAttribute('fit','')
			return img
		}

	})(document)
</script>
