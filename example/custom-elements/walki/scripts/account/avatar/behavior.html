<script>
	'use strict';
	const ProfileAvatars = {

		get user(){ return this.getList('female').concat(this.getList('male')); },

		get data(){
			return {
				'male-key':'/images/avatars/Circled User Male Skin Type',
				'female-key':'/images/avatars/Circled User Female Skin Type',
				'female-count':6,
				'male-count':6
			};
		},
		random(list){ if(!list){list = this.user;} return list[Math.floor(Math.random() * list.length)]; },
		getList(type){
			var data = [];
			for(var i=1;i<=this.data[type+'-count'];i++){
				data.push({
					index:i,
					type:type,
					id:type+'-'+i,
					key:this.data[type+'-key'],
					src:this.data[type+'-key']+' '+i+'.png'
				});
			}
			return data;
		},
		get(id){
			return this.user.filter((avatar)=>{
				if(avatar.id === id){
					return true;
				}
				return false;
			})[0];
		},
		find(id){
			"use strict";
			var data;
			if(typeof id === 'string'){
				var type = id.split('-')[0];
				var index = parseInt(id.split('-')[1]);
				data = this.user.filter(function (av) {
					if (av.index === index) {
						if (av.type === type) {
							return true;
						}
					}
					return false;
				})[0];
			}
			return (typeof data === 'undefined') ? this.get(id):data;
		},
		getAvatar(){
			"use strict";
			if(!this.currentAvatar){
				if(window.user && window.user.element && window.user.element._avatar){
					this.currentAvatar = this.find(window.user.element._avatar.id)
				}
			}
			if(this.currentAvatar) return this.currentAvatar;
			return false;
		},
		setAvatar(avatar){
			"use strict";
			this.currentAvatar=avatar;
		}
	}

	ProfileAvatars.AvatarBehavior = {
			properties: {
				avatar: {type:Object,notify:true}
			},
			getCurrentAvatar(){
				return ProfileAvatars.getAvatar();
			},
			attached(){
				var ca = this.getCurrentAvatar()
				if (!ca) {
					this.avatar = ProfileAvatars.random()
				} else {
					ca.userSelected=true;
					this.avatar = ca;
				}
				window.addEventListener('avatar',(e)=>{
					this.avatar=e.detail;
				})
			}
		};

	ProfileAvatars.AvatarPicker = {
			properties: {
				avatar: {
					type: Object,
					notify: true
				},
				selectedAvatar: {
					type: String,
					observer: '_onSelectedAvatar'
				},
				items: {
					type: Array,
					value: function () {
						return ProfileAvatars.user;
					}
				}
			},
			_getAvatar(id){
				return ProfileAvatars.find(id);
			},
			selectURL(url){
				var avatar = this.items.filter(function(item){ return item.src === url; })[0];
				if(avatar){
					this.selectAvatar(avatar.id);
				}
				return avatar;
			},
			selectAvatar(id){
				this.selectedAvatar = id;
			},
			_onSelectedAvatar(selectedAvatar, oldAvatar){

				if (selectedAvatar) {
					var data = this._getAvatar(selectedAvatar);
					if (data) {
						data.userSelected=true;
						this.avatar = data;
						ProfileAvatars.setAvatar(this.avatar);
						window.dispatchEvent(new CustomEvent('avatar',{bubbles:true,detail:this.avatar}));

					}
				}
			}
		}

</script>
