<template id="code-page-template">
	<style>
		@import "/modules/wwi/component/design/host.css";
		[view] {
			box-sizing: border-box;
			position: relative;
			height:100%;
			width: 100%;
		}
		code-snippet{
			border-right:1px solid rgb(221, 221, 221);
		}
		code-snippet,
		code-editor{
			width: 100%;
			height: 100%;
		}
	</style>

	<div view gui horizontal>
		<code-snippet></code-snippet>
		<code-editor language="graphql" theme="neat"></code-editor>
	</div>

	<div id="title"></div>
</template>
<script>
	(function (doc) {
		const Page = wwi.page(doc)
		Page(class extends Page.Element {
			get snippet() { return this.query('code-snippet')}
			get code() { return this.query('code-editor')}
			connected(){
				this.unset=true
			}
			transitioned(e) {
				if (this.active && this.unset) {
					delete this.unset
					this.snippet.resize()
					this.code.resize()
					let codes = get_codes(fxy.get('element'))
					let code = document.createElement('div')
					code.innerHTML = this.constructor.toString()
					this.snippet.append(code)
//					codes.forEach(code => this.snippet.appendChild(code))
				}
			}
		})

		function get_codes(...targets) {
			return targets.map(target => get_code(target))
		}

		function get_object(target) {
			let object = {}
			if (fxy.is.map(target)) {
				object = {}
				for (let name of target.keys()) {
					object[name] = target.get(name)
				}
			}
			if (fxy.is.object(target)) {
				let prototype = target.constructor.prototype
				for (let name in prototype) {
					object[name] = target[name]
				}
			}
			else return target
			return object
		}

		function get_code(targets) {
			targets = get_object(targets)
			let code = new Map()
			for (let name in targets) {
				let value =  get_object(targets[name])
				try {
					if (fxy.is.function(value)) code.set(name, value.valueOf())
					else if (fxy.is.object(value)) {
						try {
							code.set(name, JSON.stringify(value))
						} catch (e) {
							code.set(name, e.message)
						}
					}
					else {
						code.set(name, value)
					}
				}
				catch (e) {
					code.set(name, e.message)
				}
			}
			let code_text = ''
			for (let kv of code) {
				code_text += `//${kv[0]}:\n\t${kv[1]}\n\n`
			}
			let c = app.create('div')
			c.innerHTML = code_text
			return c
		}
	})(document)
</script>