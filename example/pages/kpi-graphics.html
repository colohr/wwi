<template id="kpi-graphics-page">
	<style>
		@import "/modules/wwi/component/design/host.css";

		:host{
			--container-height:calc(100% - 35px);
			--list-width:240px;
		}

		[view]{
			background-color: whitesmoke;
		}

		type-dash{
			--toolbar-button:var(--berry);
		}

		[content]{
			position:relative;
			max-height:var(--container-height);
		}

		[api-title]{
			color:var(--berry);
			font-size:22px;
			font-weight: 900;
			padding:3px;
			display: inline-block;
			position: relative;
		}


		content-menu{
			color:var(--berry);
			width:var(--list-width);
			display: inline-block;
			position:relative;
			max-height: 100%;
			overflow-y:auto;
			border-right:1px solid lightgray;
		}

		content-menu a{
			display: block;
			width:100%;
			cursor:pointer;
			border-bottom:1px solid lightgray;
			padding:5px;
		}
		content-menu a[aria-selected="true"]{
			background-color: var(--berry);
			color:white;
		}
		[graphics]{
			display: block;
			overflow-y: auto;
			max-height: calc( 100% - 46px );
			position:relative;
			background-color: whitesmoke;
			padding:5px;
			text-align:center;
		}
		[graphics] img{
			display:inline-block;
			margin:5px;
			border-radius:7px;
			padding:5px;
			background-color:white;
			position:relative;
			height:auto;
			border:1px solid rgba(0,0,0,0.1);
			box-sizing: border-box;
		}
	</style>

	<!--<kpi-dash host="http://localhost" port="2223" paths="api,kindle-publishing,graph"></kpi-dash>-->


	<div view fit gui vertical>
		<type-dash name="kindle-publishing">
			<div api-title slot="tool">Graphic Banks</div>
		</type-dash>
		<div content gui horizontal>
			<content-menu flex-2></content-menu>
			<div graphics  flex-7>

			</div>
		</div>

	</div>


</template>
<script>
	(function (doc) {
		const Page = wwi.page(doc)
		Page(class extends Page.Element{

			connected(){
				let dash = this.query('type-dash')
				dash.container = this
				dash.api.control = {
					container:this,
					queries:fxy.require('kpi/queries')
				}

				this.list.on('select',(e)=>{
					let name = e.detail.item.getAttribute('name')
					dash.load('graphic_bank',name).then(data=>{
						let graphic = this.graphics
						graphic.innerHTML = ''
						let unused_title = document.createElement('div')
						unused_title.style.padding='10px'
						unused_title.style.background = 'rgba(0,0,0,0.2)'
						unused_title.style.marginTop = '10px'
						unused_title.innerHTML = `${name} Graphics`
						graphic.appendChild(unused_title)
						for(let item of data.graphics){
							graphic.appendChild(get_graphic(item))
						}
						unused_title = document.createElement('div')
						unused_title.style.padding='10px'
						unused_title.style.background = 'rgba(0,0,0,0.2)'
						unused_title.style.marginTop = '10px'
						unused_title.innerHTML = 'Unused Graphics'
						graphic.appendChild(unused_title)
						for(let item of data.unused){
							graphic.appendChild(get_graphic(item))
						}
					})
				})

				dash.load('bank_names').then(data=>{
					for(let i of data){
						let item = document.createElement('a')
						item.setAttribute('role','option')
						item.setAttribute('name',i)
						item.innerHTML = `<div>${i}</div>`
						this.list.appendChild(item)
					}
					this.list.update_items()
				})

			}
			get dash(){ return this.query('type-dash') }
			get list(){ return this.query('content-menu') }
			get graphics(){ return this.query('[graphics]') }

		})
		//shared actions
		function get_graphic(graphic){
			let img = document.createElement('img')
			img.src = graphic.value
			img.name = graphic.id
			return img
		}

	})(document)
</script>