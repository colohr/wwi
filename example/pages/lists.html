<template id="lists-page">
	<style>
		@import "/modules/wwi/component/design/host.css";
		browser-list{
			display: inline-block;
			width: calc(98.9% / 3);
			top:1px;
			height:calc(100% - 1px);
			background:white;
		}
		sticky-list{
			display: inline-block;
			width: calc(98.9% / 3);
			top:1px;
			height:calc(100% - 1px);
			background:white;
			--header-shadow:clear;
			--header-fixed-width:100%;
			--header-title-left:0px;
			--header-radius:0;
			--header-height:34px;
			--header-back:white;
			--header-fixed-shadow:drop-shadow(-6px 0 10px rgba(0,0,0,0.4));
			--header-fixed-y:translateY(0);
		}
	</style>
	<browser-list></browser-list>
	<sticky-list multi id="one"></sticky-list>
</template>
<script>
	(function (doc) {
		const Page = wwi.page(doc)
		Page(class extends Page.Element{
			get list(){return this.query('browser-list')}
			connected(){
				this.unset = true
				let colors = fxy.require('design/colors')
				this.on('active',()=>{
					if('unset' in this){
						set_browser(this)
						this.sticky.on('items',e=>{for(let item of e.detail) item.background = item.data.value})
						this.sticky.set_items(...(get_transparent_items(2)))
						delete this.unset
					}

				})
			}
			get sticky(){ return this.query('sticky-list')}
		})

		//shared actions
		function get_data(){
			return fetch(url.logic('banks.json')).then(res=>res.json())
		}

		function get_transparent_items(number_of_items=10){
			let colors = fxy.require('design/colors')
			let items = []
			let increment = 1/number_of_items
			for(let i=1;i<=number_of_items;i++){
				for(let color of colors.keys()){
					if(!color.includes('-bg') && !color.includes('-50')){
						let t = parseFloat((i * increment).toFixed(4))
						let c = colors.transparent(color,t)
						items.push({
							name:`${color} ${t}`,
							value:c,
							name_html:`<div body select-all>${c}</div>
												<div description sort select-text>${color}</div>
												<div tag>${t}</div>
											   `
						})
					}
				}
			}
			return items
		}

		function set_browser(page){
			if('unset' in page){
				get_data().then(data=>{
					return set_data(page.list,data)
				}).then(()=>{
					page.list.on('select',(e)=>{
						if(page.list.selected_item){
							page.list.selected_item.selected=false
						}
						let selection = e.detail
						if(!selection.selected) selection.selected=true
						page.list.selected_item = selection
					})
				}).catch(console.error)
				delete page.unset
			}
		}

		function set_data(list,data){
			return new Promise((success,error)=>{
				for(let item of data){
					let bank = list.add_section(item)
					set_sections(bank)
				}
				return success()
			})
		}

		function set_items(list){
			let data = list.data.items
			delete list.data.items
			for(let item of data){
				item.title = item.ditl
				list.add_item(item)
			}
		}

		function set_sections(list){
			let data = list.data.sections
			delete list.data.sections
			for(let item of data){
				let section = list.add_section(item)
				set_targets(section)
			}
		}

		function set_targets(list){
			let data = list.data.targets
			delete list.data.targets
			for(let item of data){
				let target = list.add_section(item)
				set_items(target)
			}
		}




	})(document)
</script>